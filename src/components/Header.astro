---
interface Props {
  categories?: string[];
}
const { categories = [] } = Astro.props as Props;
---
<header class="sticky top-0 z-40 border-b border-[var(--color-border)] bg-[var(--color-card)]/80 backdrop-blur supports-[backdrop-filter]:bg-[var(--color-card)]/60">
  <div class="mx-auto flex max-w-6xl items-center gap-3 p-3">
    <a href="/" class="text-base font-semibold text-gray-900 dark:text-gray-100">Byas Store</a>
    {categories.length > 0 && (
      <details class="relative">
        <summary class="list-none inline-flex cursor-pointer items-center gap-1 rounded-md border border-[var(--color-border)] bg-[var(--color-card)] px-3 py-1.5 text-xs text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700">
          Categories
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 10l5 5 5-5z"/></svg>
        </summary>
        <div class="absolute left-0 mt-2 w-44 rounded-md border border-[var(--color-border)] bg-[var(--color-card)] p-1 shadow-lg">
          <button type="button" data-cat="" class="block w-full rounded px-2 py-1 text-left text-xs text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700">All</button>
          {categories.map((c) => (
            <button type="button" data-cat={c} class="block w-full rounded px-2 py-1 text-left text-xs text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700">
              {c}
            </button>
          ))}
        </div>
      </details>
    )}
    <div class="flex-1"></div>
    <form role="search" aria-label="Product search" on:submit|preventDefault>
      <label class="sr-only" for="site-search">Search products</label>
      <div class="relative w-48 md:w-64">
        <input id="site-search" name="q" type="search" placeholder="Search" class="w-full rounded-md border border-gray-300 bg-white pr-9 px-3 py-1.5 text-sm text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[var(--color-accent)] dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100" />
        <button type="button" aria-label="Search" class="absolute right-1.5 top-1/2 -translate-y-1/2 rounded p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200" id="searchBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M21 20l-5.6-5.6a7 7 0 10-1.4 1.4L20 21l1-1zM10 15a5 5 0 110-10 5 5 0 010 10z"/></svg>
        </button>
      </div>
    </form>
    <button
      id="themeToggle"
      class="ml-2 inline-flex items-center gap-2 rounded border border-gray-200 bg-white px-3 py-2 text-gray-900 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[var(--color-accent)] dark:border-gray-700 dark:bg-gray-800 dark:text-gray-100 dark:hover:bg-gray-700"
      aria-label="Toggle color scheme"
      type="button"
    >
      <span data-icon-light class="hidden dark:inline-block" aria-hidden="true">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 1 0 9.79 9.79Z"/></svg>
      </span>
      <span data-icon-dark class="inline-block dark:hidden" aria-hidden="true">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.79 1.8-1.79zm10.48 0l1.79-1.79-1.79-1.8-1.79 1.8 1.79 1.79zM12 4V1h-1v3h1zm5 8h3v-1h-3v1zM4 12H1v-1h3v1zm1.84 7.4l-1.8 1.8 1.8 1.79 1.79-1.79-1.79-1.8zm11.6 0l1.8 1.79 1.79-1.79-1.79-1.8-1.8 1.8zM12 23v-3h-1v3h1zm0-16a5 5 0 100 10 5 5 0 000-10z"/></svg>
      </span>
      <span class="text-sm text-gray-600 dark:text-gray-400" data-theme-label></span>
    </button>
    
  </div>
  <script>
    // @ts-check
    // Client-side search + category events
    document.addEventListener('DOMContentLoaded', () => {
      const input = /** @type {HTMLInputElement|null} */ (document.getElementById('site-search'))
      const searchBtn = document.getElementById('searchBtn')
      if (input) {
        input.addEventListener('input', () => {
          const ev = new CustomEvent('byas:search', { detail: { q: input.value } })
          window.dispatchEvent(ev)
        })
      }
      searchBtn?.addEventListener('click', () => {
        const q = input?.value || ''
        const ev = new CustomEvent('byas:search', { detail: { q } })
        window.dispatchEvent(ev)
      })
      // Categories dropdown buttons
      document.querySelectorAll('details button[data-cat]').forEach((el) => {
        el.addEventListener('click', (e) => {
          const target = /** @type {HTMLElement} */ (e.currentTarget)
          const cat = target.getAttribute('data-cat') || ''
          const ev = new CustomEvent('byas:category', { detail: { category: cat } })
          window.dispatchEvent(ev)
          const parent = target.closest('details')
          if (parent) (parent as HTMLDetailsElement).open = false
        })
      })
    })
  </script>
  <style></style>
</header>